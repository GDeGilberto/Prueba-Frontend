<!-- Register Page - Semantic HTML -->
<main class="register-main" role="main">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-5">
        <article class="register-card card shadow-lg border-0" role="region" aria-labelledby="register-title">
          <div class="card-body p-5">
            <!-- Header Section -->
            <header class="register-header text-center mb-4">
              <i class="fas fa-user-plus fa-3x text-primary mb-3" aria-hidden="true"></i>
              <h1 id="register-title" class="card-title text-dark h2">Crear Cuenta</h1>
              <p class="text-muted">Regístrate para acceder</p>
            </header>

            <!-- Success Message -->
            <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
              <i class="fas fa-check-circle me-2" aria-hidden="true"></i>
              {{ successMessage }}
            </div>

            <!-- Error Message -->
            <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
              <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
              {{ errorMessage }}
            </div>

            <!-- Register Form -->
            <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate aria-describedby="form-description">
              <p id="form-description" class="sr-only">
                Formulario para crear una nueva cuenta de usuario
              </p>
              <!-- Email Field -->
              <div class="mb-3">
                <label for="email" class="form-label">
                  <i class="fas fa-envelope me-2" aria-hidden="true"></i>
                  <span>Email</span>
                </label>
                <input 
                  type="email" 
                  id="email"
                  formControlName="email"
                  class="form-control form-control-lg"
                  [class.is-invalid]="submitted && f['email'].errors"
                  placeholder="usuario@ejemplo.com"
                  autocomplete="email"
                  aria-describedby="email-error"
                />
                <div 
                  id="email-error"
                  *ngIf="submitted && f['email'].errors" 
                  class="invalid-feedback"
                  role="alert">
                  <div *ngIf="f['email'].errors['required']">
                    El email es requerido
                  </div>
                  <div *ngIf="f['email'].errors['email']">
                    Ingresa un email válido
                  </div>
                </div>
              </div>

              <!-- Usuario Field -->
              <div class="mb-3">
                <label for="nombreUsuario" class="form-label">
                  <i class="fas fa-user me-2" aria-hidden="true"></i>
                  <span>Nombre de Usuario</span>
                </label>
                <input 
                  type="text" 
                  id="nombreUsuario"
                  formControlName="nombreUsuario"
                  class="form-control form-control-lg"
                  [class.is-invalid]="submitted && f['nombreUsuario'].errors"
                  placeholder="Mínimo 7 caracteres alfanuméricos"
                  autocomplete="username"
                  aria-describedby="username-error"
                />
                <div 
                  id="username-error"
                  *ngIf="submitted && f['nombreUsuario'].errors" 
                  class="invalid-feedback"
                  role="alert">
                  <div *ngIf="f['nombreUsuario'].errors['required']">
                    El nombre de usuario es requerido
                  </div>
                  <div *ngIf="f['nombreUsuario'].errors['minlength']">
                    Debe tener al menos 7 caracteres
                  </div>
                  <div *ngIf="f['nombreUsuario'].errors['alphanumeric']">
                    Solo se permiten caracteres alfanuméricos
                  </div>
                </div>
              </div>

              <!-- Contraseña Field -->
              <div class="mb-3">
                <label for="contraseña" class="form-label">
                  <i class="fas fa-lock me-2" aria-hidden="true"></i>
                  <span>Contraseña</span>
                </label>
                <input 
                  type="password" 
                  id="contraseña"
                  formControlName="contraseña"
                  class="form-control form-control-lg"
                  [class.is-invalid]="submitted && f['contraseña'].errors"
                  placeholder="Mínimo 10 caracteres"
                  autocomplete="new-password"
                  aria-describedby="password-error"
                />
                <div 
                  id="password-error"
                  *ngIf="submitted && f['contraseña'].errors" 
                  class="invalid-feedback"
                  role="alert">
                  <div *ngIf="f['contraseña'].errors['required']">
                    La contraseña es requerida
                  </div>
                  <div *ngIf="f['contraseña'].errors['minlength']">
                    Debe tener al menos 10 caracteres
                  </div>
                  <div *ngIf="f['contraseña'].errors['passwordStrength']">
                    <small>La contraseña debe contener:</small>
                    <ul class="mb-0 mt-1">
                      <li *ngIf="!f['contraseña'].errors['passwordStrength'].hasUpperCase">Al menos una mayúscula</li>
                      <li *ngIf="!f['contraseña'].errors['passwordStrength'].hasLowerCase">Al menos una minúscula</li>
                      <li *ngIf="!f['contraseña'].errors['passwordStrength'].hasNumeric">Al menos un número</li>
                      <li *ngIf="!f['contraseña'].errors['passwordStrength'].hasSymbol">Al menos un símbolo</li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Confirmar Contraseña Field -->
              <div class="mb-3">
                <label for="confirmarContraseña" class="form-label">
                  <i class="fas fa-lock me-2" aria-hidden="true"></i>
                  <span>Confirmar Contraseña</span>
                </label>
                <input 
                  type="password" 
                  id="confirmarContraseña"
                  formControlName="confirmarContraseña"
                  class="form-control form-control-lg"
                  [class.is-invalid]="submitted && (f['confirmarContraseña'].errors || registerForm.hasError('passwordMismatch'))"
                  placeholder="Repite tu contraseña"
                  autocomplete="new-password"
                  aria-describedby="confirm-password-error"
                />
                <div 
                  id="confirm-password-error"
                  *ngIf="submitted && (f['confirmarContraseña'].errors || registerForm.hasError('passwordMismatch'))" 
                  class="invalid-feedback"
                  role="alert">
                  <div *ngIf="f['confirmarContraseña'].errors?.['required']">
                    La confirmación de contraseña es requerida
                  </div>
                  <div *ngIf="registerForm.hasError('passwordMismatch')">
                    Las contraseñas no coinciden
                  </div>
                </div>
              </div>

              <!-- Sexo Field -->
              <div class="mb-4">
                <label class="form-label">
                  <i class="fas fa-venus-mars me-2" aria-hidden="true"></i>
                  <span>Sexo</span>
                </label>
                <div class="d-flex gap-4">
                  <div class="form-check" *ngFor="let option of sexoOptions">
                    <input 
                      type="radio"
                      [id]="'sexo-' + option.value"
                      formControlName="sexo"
                      [value]="option.value"
                      class="form-check-input"
                      [class.is-invalid]="submitted && f['sexo'].errors"
                    />
                    <label [for]="'sexo-' + option.value" class="form-check-label">
                      {{ option.label }}
                    </label>
                  </div>
                </div>
                <div *ngIf="submitted && f['sexo'].errors" class="invalid-feedback d-block">
                  <div *ngIf="f['sexo'].errors['required']">
                    Debes seleccionar el sexo
                  </div>
                </div>
              </div>

              <!-- Submit Button -->
              <div class="d-grid gap-2 mb-3">
                <button 
                  type="submit" 
                  class="btn btn-primary btn-lg"
                  [disabled]="loading"
                  [attr.aria-describedby]="loading ? 'loading-message' : null">
                  <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
                  <span *ngIf="loading" id="loading-message" class="sr-only">Registrando usuario...</span>
                  {{ loading ? 'Registrando...' : 'Crear Cuenta' }}
                </button>
              </div>

              <!-- Login Link -->
              <div class="text-center">
                <p class="mb-0">
                  ¿Ya tienes cuenta? 
                  <a routerLink="/login" class="text-primary text-decoration-none fw-bold">
                    Inicia sesión aquí
                  </a>
                </p>
              </div>
            </form>
          </div>
        </article>
      </div>
    </div>
  </div>
</main>