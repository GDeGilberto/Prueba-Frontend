<div class="dashboard-container">
  <!-- Header con navegación -->
  <mat-toolbar color="primary" class="dashboard-header">
    <mat-icon>dashboard</mat-icon>
    <span class="header-title">Administración de Usuarios</span>
    
    <span class="spacer"></span>
    
    <button mat-button [matMenuTriggerFor]="userMenu" class="user-menu-button">
      <i class="fas fa-user-circle"></i>
      <span *ngIf="currentUser$ | async as user" class="user-name-header">{{ user.nombreUsuario || user.email }}</span>
    </button>
    
    <mat-menu #userMenu="matMenu">
      <button mat-menu-item (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Cerrar Sesión</span>
      </button>
    </mat-menu>
  </mat-toolbar>

  <!-- Contenido principal -->
  <div class="dashboard-content">
    <!-- Estadísticas resumidas -->
    <div class="stats-container">
      <mat-card class="stats-card">
        <mat-card-content>
          <div class="stats-grid">
            <div class="stat-item">
              <mat-icon class="stat-icon total">group</mat-icon>
              <div class="stat-info">
                <div class="stat-number">{{ getTotalUsuarios() }}</div>
                <div class="stat-label">Total Usuarios</div>
              </div>
            </div>
            
            <div class="stat-item">
              <mat-icon class="stat-icon active">check_circle</mat-icon>
              <div class="stat-info">
                <div class="stat-number">{{ getUsuariosActivos() }}</div>
                <div class="stat-label">Usuarios Activos</div>
              </div>
            </div>
            
            <div class="stat-item">
              <mat-icon class="stat-icon inactive">cancel</mat-icon>
              <div class="stat-info">
                <div class="stat-number">{{ getUsuariosInactivos() }}</div>
                <div class="stat-label">Usuarios Inactivos</div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Tabla de usuarios -->
    <mat-card class="table-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>people</mat-icon>
          Lista de Usuarios
        </mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <!-- Filtros -->
        <div class="filters-container">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Buscar usuarios</mat-label>
            <input 
              matInput 
              [(ngModel)]="filtroTexto" 
              (input)="onFiltroTextoChange()"
              placeholder="Nombre, email, etc.">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Filtrar por estado</mat-label>
            <mat-select [(value)]="filtroEstatus" (selectionChange)="onFiltroEstatusChange()">
              <mat-option *ngFor="let option of estatusOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <button 
            mat-raised-button 
            color="accent" 
            (click)="clearFilters()"
            class="clear-filters-btn">
            <mat-icon>clear</mat-icon>
            Limpiar Filtros
          </button>
        </div>

        <!-- Tabla -->
        <div class="table-container" [class.loading]="loading">
          <mat-table [dataSource]="dataSource" matSort class="usuarios-table">
            
            <!-- Columna ID -->
            <ng-container matColumnDef="id">
              <mat-header-cell *matHeaderCellDef mat-sort-header>ID</mat-header-cell>
              <mat-cell *matCellDef="let usuario">{{ usuario.id }}</mat-cell>
            </ng-container>

            <!-- Columna Nombre de Usuario -->
            <ng-container matColumnDef="nombreUsuario">
              <mat-header-cell *matHeaderCellDef mat-sort-header>Usuario</mat-header-cell>
              <mat-cell *matCellDef="let usuario">
                <div class="user-cell">
                  <mat-icon class="user-avatar">account_circle</mat-icon>
                  <span class="user-name">{{ usuario.nombreUsuario }}</span>
                </div>
              </mat-cell>
            </ng-container>

            <!-- Columna Email -->
            <ng-container matColumnDef="email">
              <mat-header-cell *matHeaderCellDef mat-sort-header>Email</mat-header-cell>
              <mat-cell *matCellDef="let usuario">{{ usuario.email }}</mat-cell>
            </ng-container>

            <!-- Columna Sexo -->
            <ng-container matColumnDef="sexo">
              <mat-header-cell *matHeaderCellDef mat-sort-header>Sexo</mat-header-cell>
              <mat-cell *matCellDef="let usuario">
                <mat-chip [class]="'sexo-chip-' + usuario.sexo">
                  <mat-icon>{{ usuario.sexo === 0 ? 'male' : 'female' }}</mat-icon>
                  {{ usuario.sexoText }}
                </mat-chip>
              </mat-cell>
            </ng-container>

            <!-- Columna Estado -->
            <ng-container matColumnDef="estatus">
              <mat-header-cell *matHeaderCellDef mat-sort-header>Estado</mat-header-cell>
              <mat-cell *matCellDef="let usuario">
                <mat-chip [class]="'status-chip-' + usuario.estatus">
                  <mat-icon>{{ usuario.estatus === 1 ? 'check_circle' : 'cancel' }}</mat-icon>
                  {{ usuario.estatusText }}
                </mat-chip>
              </mat-cell>
            </ng-container>

            <!-- Columna Acciones -->
            <ng-container matColumnDef="acciones">
              <mat-header-cell *matHeaderCellDef>Acciones</mat-header-cell>
              <mat-cell *matCellDef="let usuario">
                <div class="actions-cell">
                  <button 
                    mat-icon-button 
                    color="primary" 
                    (click)="editarUsuario(usuario)"
                    matTooltip="Editar usuario">
                    <mat-icon>edit</mat-icon>
                  </button>
                  
                  <button 
                    mat-icon-button 
                    [color]="usuario.estatus === 1 ? 'warn' : 'accent'"
                    (click)="eliminarUsuario(usuario)"
                    [matTooltip]="usuario.estatus === 1 ? 'Desactivar usuario' : 'Activar usuario'">
                    <mat-icon>{{ usuario.estatus === 1 ? 'block' : 'check_circle' }}</mat-icon>
                  </button>
                </div>
              </mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;" class="usuario-row"></mat-row>
          </mat-table>

          <!-- Estado de carga -->
          <div *ngIf="loading" class="loading-overlay">
            <mat-spinner diameter="50"></mat-spinner>
            <p>Cargando usuarios...</p>
          </div>

          <!-- Sin resultados -->
          <div *ngIf="!loading && dataSource.filteredData.length === 0" class="no-results">
            <mat-icon class="no-results-icon">search_off</mat-icon>
            <h3>No se encontraron usuarios</h3>
            <p>Intenta ajustar los filtros de búsqueda</p>
          </div>
        </div>

        <!-- Paginador -->
        <mat-paginator 
          [pageSizeOptions]="[5, 10, 20, 50]"
          [pageSize]="10"
          showFirstLastButtons
          aria-label="Seleccionar página de usuarios">
        </mat-paginator>
      </mat-card-content>
    </mat-card>
  </div>
</div>